# Coverage Improvement Status - 2026.01.01

**Overall Coverage:** ~60%+ (Estimated)

## Achievements

### Stage 1: Core Security (Completed)
*   **`crates/mdmcp_policy`**: Improved to ~80% coverage.
*   **`mdmcpsrvr/src/fs_safety.rs`**: Improved to ~86% coverage.
*   **`mdmcpsrvr/src/sandbox.rs`**: Improved to ~74% coverage.

### Stage 2: Server Request Handling (Completed for today)
*   **`mdmcpsrvr/src/server.rs`**: Improved from ~41% to ~53%.
    *   Added tests for `initialize`, `list_directory`, `stat_path`, `resources`, `prompts`, `fs.write` modes, `get_command_catalog`, `cmd.run` failures.

### Stage 3: Configuration CLI (Started)
*   **`mdmcpcfg/src/commands/doctor.rs`**: Improved from 0% to ~51%.
    *   Added `mod tests` with `setup_test_env` helper using `tempfile`.
    *   Implemented serial testing with `OnceLock<Mutex<()>>` to handle global environment variable overrides (`MDMCP_TEST_ROOT`).
    *   Tested `check_installation`, `check_policy` (missing/valid), `check_claude_desktop` (missing/configured).

## Pending Work (For Future Sessions)

1.  **Server Logic Deep Dive**:
    *   `mdmcpsrvr/src/server.rs`: Target 80%+. Needs testing of helper functions, more edge cases in `cmd.run` execution results, and platform-specific logic where possible.

2.  **CLI Install Command**:
    *   `mdmcpcfg/src/commands/install.rs` (20% coverage). Needs mocking of GitHub API calls and file downloads.

3.  **Plugins**:
    *   `plugins/mdaicli` and others. Mocking AI providers is key here.

4.  **Integration**:
    *   End-to-end stdio tests in `tests/` folder could be expanded to cover more complex scenarios.